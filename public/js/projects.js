/**
 * SAHARA Web Interface
 *
 * User interface to Sahara Remote Laboratory system.
 *
 * @license See LICENSE in the top level directory for complete license terms.
 *
 * Copyright (c) 2010, University of Technology, Sydney
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *  * Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 *  * Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *  * Neither the name of the University of Technology, Sydney nor the names
 *    of its contributors may be used to endorse or promote products derived from
 *    this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author Michael Diponio (mdiponio)
 * @date 31st October 2012
 */

/**
 * Displays the add project dialog. 
 */
function displayAddProjectDialog()
{
	var i = 0, html = 
		"<div id='add-project-dialog' title='Add Project'>" +
			"<form id='add-project-form' class='sahara-form'>" +
				"<div class='form-line'>" +
					"<label for='add-activity-id'>Activity ID:</label>" +
					"<input id='add-activity-id' type='text' name='add-activity-id' />" +
					"<div class='guidance-button'>" +
						"<span class='ui-icon ui-icon-help'></span>" +
						"<p>The activity ID of the project. If you have a 'Research Master' project ID, use that as your ID.</p>" +
					"</div>" + 
				"</div>" +
				"<div class='form-line'>" +
					"<label for='add-permissions'>Permissions:</label>" +
					"<select id='add-permissions' name='add-permissions'>";
	
	/* Groups the user is a member of. */
	for (i in userClasses)
	{
		html += 		"<option value='" + userClasses[i].id + "'>" + userClasses[i].name.split("_").join(" ") + "</option>";
	}
	
	
    html += 		"</select>" +
    				"<div class='guidance-button'>" +
    					"<span class='ui-icon ui-icon-help'></span>" +
						"<p>Selects the rigs that this project uses to generate datasets.</p>" +
					"</div>" + 
				"</div>" +
				"<div class='form-line'>" +
					"<label for='add-share-collection'>Share Collection:</label>" +
					"<input id='add-share-collection' type='checkbox' name='add-share-collection' />" +
					"<div class='guidance-button'>" +
						"<span class='ui-icon ui-icon-help'></span>" +
						"<p>Whether to share the projects and it's datasets with ANDS.</p>" +
					"</div>" + 
				"</div>" +
				"<div class='form-line'>" +
					"<label for='add-open-access'>Open Access:</label>" +
					"<input id='add-open-access' type='checkbox' name='add-open-access' />" +
					"<div class='guidance-button'>" +
						"<span class='ui-icon ui-icon-help'></span>" +
						"<p>Whether the datasets generated by this project is openly accessiable.</p>" + 
					"</div>" + 
				"</div>" +
				"<div class='form-line'>" +
					"<label for='add-auto-publish'>Auto Publish:</label>" +
					"<input id='add-auto-publish' type='checkbox' name='add-auto-publish' />" +
					"<div class='guidance-button'>" +
						"<span class='ui-icon ui-icon-help'></span>" +
						"<p>Whether datasets are automatically published as they are generated by using the " +
						"research equipment. If they are not automatically published, collections of datasets " +
						"need to manually collated.</p>" + 
					"</div>" + 
				"</div>";
    
    /* Other metadata of the project. */
    for (i in definitions)
    {
    	html += "<div class='form-line'>" +
    				"<label for='" + definitions[i].id + "'>" + definitions[i].name + ":</label>" +
    				(definitions[i].optional ? "<input id='" + definitions[i].id + "-enable' type='checkbox' class='metadata-enable' />" : "") +
    				"<input id='" + definitions[i].id + "' type='text' name='" + definitions[i].id + "' " + (definitions[i].optional ? "disabled='disabled'" : "") + " />" +
    				"<div class='guidance-button'>" +
    					"<span class='ui-icon ui-icon-help'></span>" +
    					"<p>" + definitions[i].description + "</p>" +
    				"</div>" +
    			"</div>";
    }
    
	html +=	"</form>" +
		"</div>";
	
	/* Display the form dialog. */
	$("body").append(html);
	$("#add-project-dialog").dialog({
		modal: true,
		resizable: false,
		width: 400,
		buttons: {
			Add: addProject,
			Cancel: function() { $(this).dialog("close"); }
		},
		close: function() { $(this).dialog("destroy"); $(this).remove(); },
	}).parent().css('overflow', 'visible');
	
	/* Enable disable optional metadata fields. */
	$("#add-project-dialog .metadata-enable").click(function() {
		if ($(this).parent().has(":checked").length == 1)
		{
			/* Enable the input. */
			$(this).siblings("input").removeAttr("disabled");
		}
		else
		{
			/* Disable the input and clear contents. */
			$(this).siblings("input").attr("disabled", "disabled")
									  .val("");
		}
	});
	
	/* Form element focus. */
	$("#add-project-dialog input").focusin(formFocusIn).focusout(formFocusOut);
	
	/* Guidance button handling. */
	new GuidanceBubble("#add-project-dialog", "info", "left", 20, 20).initButtons();
}

/**
 * Adds a project using the contents of the add project dialog.
 */
function addProject() 
{
	var params = {}, valid = true;
	
	/* Validate entered values. */
	if ((params.activityID = $("#add-activity-id").val()) == "")
	{
		valid = false;
		new GuidanceBubble("#add-project-dialog", "error", "left").show($("#add-activity-id"), "Activity ID must be set.");
	}
	
	

}