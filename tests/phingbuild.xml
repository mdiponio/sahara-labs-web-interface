<?xml version="1.0" encoding="UTF-8"?>
<!-- Based on http://www.davegardner.me.uk/blog/2009/11/09/continuous-integration-for-php-using-hudson-and-phing/ -->
<!-- Based on http://luhman.org/blog/2009/12/16/installing-hudson-phing-phpunit-and-git-ubuntu -->
<!-- Based on http://phing.info/trac/wiki/Users/Documentation/Gotcha%27s -->
<!-- Need to make sure the following modules are installed via PHP-PEAR: phpcpd, pdepend, phpcs and phpunit.
			#pear channel-discover components.ez.no
			#pear channel-discover pear.phpunit.de
			#pear install phpunit/phpcpd
			#pear channel-discover pear.pdepend.org
			#pear install pdepend/PHP_Depend-beta
			#pear install PHP_CodeSniffer-1.2.0
			#pear channel-discover pear.phpunit.de
			#pear install phpunit/PHPUnit 
			#pecl install xdebug (if under windows follow instructions on http://devzone.zend.com/article/2803)
			
			On M$ Windows:
			#pear channel-disover pear.phing.info
			#pear install phing/phing
			
			Was getting the following error: '".\php.exe"' is not recognized as an internal or external command, operable program or batch file.
			Fix: Go to each script i.e. phpunit.bat, phpcs.bat, pdepend.bat, phpcpd.bat and change .\php.exe to php.exe. 
			Also make sure the PATH is set correctly Environment Variables and Reboot PC.
			
			Another Quirk (Refer to http://stackoverflow.com/questions/2403675/xdebug-is-not-loaded-in-php-vista-apache-module)
			From PHP 5.3 onwards if using XDEBUG need to use zend_extension instead of zend_extension_ts to define the module. 
-->
 <project name="test" basedir="." default="phpunit">
    <property name="builddir" value="${ws}\trunk\tests\coverage" />

    <!-- PHP copy/paste analysis -->
    <target name="phpcpd">
        <echo msg="PHP Copy/Paste..." />
        <exec command="phpcpd --log-pmd=${builddir}\pmd.xml ${ws}\trunk\application" escape="false" />
    </target>

    <!-- PHP dependency checker -->
    <target name="pdepend">
        <echo msg="PHP Depend..." />
        <exec command="pdepend --jdepend-xml=${builddir}\jdepend.xml ${ws}\trunk\application" escape="false" />
    </target>

    <!-- PHP CodeSniffer -->
    <target name="phpcs">
        <echo msg="PHP CodeSniffer..." />
        <exec command="phpcs --standard=ZEND --report=checkstyle ${ws}\trunk\application > ${builddir}\checkstyle.xml" escape="false" />
    </target>

    <!-- Unit Tests & coverage analysis -->
    <target name="phpunit">
        <echo msg="PHP Unit..." />
        <exec command="cd ${ws}\trunk\tests"/>
        <exec command="phpunit --configuration ${ws}\trunk\tests\phpunit.xml --log-junit ${builddir}\phpunitoutput.xml --coverage-clover ${builddir}\clover.xml --coverage-html ${builddir}\html\"/>
    </target>
</project>